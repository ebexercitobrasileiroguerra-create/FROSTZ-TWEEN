-- LocalScript (StarterGui)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- tenta pegar os RemoteEvents (se o servidor tiver criado)
local requestEvent = ReplicatedStorage:FindFirstChild("RequestFlyToSpawn")
local statusEvent  = ReplicatedStorage:FindFirstChild("FlyToSpawnStatus")
local useServer = (requestEvent ~= nil and statusEvent ~= nil)

-- Guarda spawn localmente (atualiza ao renascer)
local spawnPos = nil
player.CharacterAdded:Connect(function(char)
	local hrp = char:WaitForChild("HumanoidRootPart", 10)
	if hrp then
		spawnPos = hrp.Position
	end
end)
-- se já estiver com personagem
if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
	spawnPos = player.Character.HumanoidRootPart.Position
end

-- Construção da GUI (igual estilo anterior, menor e vertical)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AntiCheatMenu"
screenGui.Parent = playerGui

-- Botão para abrir/fechar o menu
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(0, 120, 0, 40)
toggleButton.Position = UDim2.new(0, 10, 0, 10) -- Canto superior esquerdo
toggleButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Text = "ABRIR MENU"
toggleButton.TextScaled = true
toggleButton.Font = Enum.Font.GothamBold
toggleButton.Parent = screenGui

local toggleBtnCorner = Instance.new("UICorner")
toggleBtnCorner.CornerRadius = UDim.new(0, 8)
toggleBtnCorner.Parent = toggleButton

local toggleBtnStroke = Instance.new("UIStroke")
toggleBtnStroke.Thickness = 2
toggleBtnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
toggleBtnStroke.Parent = toggleButton

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 250, 0, 360) -- Aumentei altura para o novo botão
frame.Position = UDim2.new(0.5, -125, 0.5, -180) -- Ajustei posição
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BackgroundTransparency = 0.15
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Visible = false -- Começa invisível
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = frame

local stroke = Instance.new("UIStroke")
stroke.Thickness = 3
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.Parent = frame

local glow = Instance.new("ImageLabel")
glow.Size = UDim2.new(1.1, 0, 1.1, 0)
glow.Position = UDim2.new(-0.05, 0, -0.05, 0)
glow.BackgroundTransparency = 1
glow.Image = "rbxassetid://5028857084"
glow.ImageTransparency = 0.35
glow.ScaleType = Enum.ScaleType.Stretch
glow.Parent = frame

-- animação RGB (borda + glow + botão toggle)
local hue = 0
task.spawn(function()
	while true do
		hue = (hue + 1) % 360
		local color = Color3.fromHSV(hue/360, 1, 1)
		stroke.Color = color
		glow.ImageColor3 = color
		toggleBtnStroke.Color = color -- Adiciona RGB ao botão toggle também
		task.wait(0.05)
	end
end)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0,0,0,6)
title.BackgroundTransparency = 1
title.Text = "FROSTZ TWEEN"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.Parent = frame

-- Botão TELEGUIAR! (subido um pouco)
local teleportBtn = Instance.new("TextButton")
teleportBtn.Size = UDim2.new(0.8, 0, 0, 46)
teleportBtn.Position = UDim2.new(0.1, 0, 0.16, 0) -- MAIS PRA CIMA
teleportBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
teleportBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
teleportBtn.Text = "TELEGUIAR!"
teleportBtn.TextScaled = true
teleportBtn.Font = Enum.Font.GothamBold
teleportBtn.Parent = frame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0,8)
btnCorner.Parent = teleportBtn

local btnStroke = Instance.new("UIStroke")
btnStroke.Thickness = 1.8
btnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
btnStroke.Parent = teleportBtn
task.spawn(function()
	while true do
		task.wait(0.05)
		btnStroke.Color = stroke.Color
	end
end)

-- Botão ESP PLAYERS (abaixo do TELEGUIAR!)
local espButton = Instance.new("TextButton")
espButton.Name = "ESPButton"
espButton.Size = UDim2.new(0.8, 0, 0, 46)
espButton.Position = UDim2.new(0.1, 0, 0.31, 0)
espButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
espButton.TextColor3 = Color3.fromRGB(255, 255, 255)
espButton.Text = "ESP PLAYERS"
espButton.TextScaled = true
espButton.Font = Enum.Font.GothamBold
espButton.Parent = frame

local espBtnCorner = Instance.new("UICorner")
espBtnCorner.CornerRadius = UDim.new(0, 8)
espBtnCorner.Parent = espButton

local espBtnStroke = Instance.new("UIStroke")
espBtnStroke.Thickness = 1.8
espBtnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
espBtnStroke.Parent = espButton

task.spawn(function()
	while true do
		task.wait(0.05)
		espBtnStroke.Color = stroke.Color
	end
end)

-- Botão SUPERMAN (novo botão)
local supermanButton = Instance.new("TextButton")
supermanButton.Name = "SupermanButton"
supermanButton.Size = UDim2.new(0.8, 0, 0, 46)
supermanButton.Position = UDim2.new(0.1, 0, 0.46, 0)
supermanButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
supermanButton.TextColor3 = Color3.fromRGB(255, 255, 255)
supermanButton.Text = "SUPERMAN"
supermanButton.TextScaled = true
supermanButton.Font = Enum.Font.GothamBold
supermanButton.Parent = frame

local supermanBtnCorner = Instance.new("UICorner")
supermanBtnCorner.CornerRadius = UDim.new(0, 8)
supermanBtnCorner.Parent = supermanButton

local supermanBtnStroke = Instance.new("UIStroke")
supermanBtnStroke.Thickness = 1.8
supermanBtnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
supermanBtnStroke.Parent = supermanButton

task.spawn(function()
	while true do
		task.wait(0.05)
		supermanBtnStroke.Color = stroke.Color
	end
end)

-- função de fallback de voo (cliente) com pausa de 2 segundos ao chegar no spawn
local function clientFlyToSpawn()
	if not spawnPos then return end
	local char = player.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	if not hrp or not humanoid then return end

	local prevPlatform = humanoid.PlatformStand
	humanoid.PlatformStand = true

	local bv = Instance.new("BodyVelocity")
	bv.MaxForce = Vector3.new(1e6,1e6,1e6)
	bv.Parent = hrp

	local bg = Instance.new("BodyGyro")
	bg.MaxTorque = Vector3.new(1e6,1e6,1e6)
	bg.Parent = hrp

	local target = spawnPos + Vector3.new(0, 8, 0)
	for i = 1, 300 do -- timeout safety (≈6s)
		if not hrp.Parent then break end
		local diff = target - hrp.Position
		if diff.Magnitude <= 3 then break end
		bv.Velocity = diff.Unit * 80
		bg.CFrame = CFrame.new(hrp.Position, target)
		task.wait(0.02)
	end

	-- fixa em cima do spawn e para o movimento
	hrp.CFrame = CFrame.new(spawnPos + Vector3.new(0,8,0))
	bv.Velocity = Vector3.new(0,0,0)

	-- pausa de 2 segundos no ar
	task.wait(2)

	if bv and bv.Parent then bv:Destroy() end
	if bg and bg.Parent then bg:Destroy() end

	task.delay(0, function()
		if humanoid and humanoid.Parent then
			humanoid.PlatformStand = prevPlatform
		end
	end)
end

if statusEvent then
	statusEvent.OnClientEvent:Connect(function(status)
		if status == "start" then
			teleportBtn.Active = false
			teleportBtn.Text = "Indo..."
		elseif status == "end" then
			teleportBtn.Active = true
			teleportBtn.Text = "Voltou!"
			task.delay(1, function() teleportBtn.Text = "TELEGUIAR!" end)
		elseif status == "no_spawn" then
			teleportBtn.Active = true
			teleportBtn.Text = "Spawn não salvo"
			task.delay(1.5, function() teleportBtn.Text = "TELEGUIAR!" end)
		end
	end)
end

teleportBtn.MouseButton1Click:Connect(function()
	teleportBtn.Active = false
	if useServer and requestEvent then
		requestEvent:FireServer()
	else
		task.spawn(function()
			teleportBtn.Text = "Indo..."
			clientFlyToSpawn()
			teleportBtn.Text = "TELEGUIAR!"
			teleportBtn.Active = true
		end)
	end
end)

-- ESP Players

local espEnabled = false

local function removeESPFromCharacter(char)
	if char then
		local highlight = char:FindFirstChild("ESPHighlight")
		if highlight then
			highlight:Destroy()
		end
		local billboard = char:FindFirstChild("ESPBillboard")
		if billboard then
			billboard:Destroy()
		end
	end
end

local function createESP(plr)
	if plr == player then return end
	local char = plr.Character
	if not char then return end

	-- Remove ESP anterior
	removeESPFromCharacter(char)

	-- Highlight
	local highlight = Instance.new("Highlight")
	highlight.Name = "ESPHighlight"
	highlight.FillColor = Color3.fromRGB(255, 0, 0)
	highlight.FillTransparency = 0.5
	highlight.OutlineTransparency = 0
	highlight.Parent = char

	-- BillboardGui com nome
	local head = char:FindFirstChild("Head")
	if head then
		local billboard = Instance.new("BillboardGui")
		billboard.Name = "ESPBillboard"
		billboard.Adornee = head
		billboard.Size = UDim2.new(0, 150, 0, 40)
		billboard.StudsOffset = Vector3.new(0, 2.5, 0)
		billboard.AlwaysOnTop = true
		billboard.Parent = char

		local label = Instance.new("TextLabel")
		label.Size = UDim2.new(1,0,1,0)
		label.BackgroundTransparency = 1
		label.TextColor3 = Color3.fromRGB(255, 0, 0)
		label.TextScaled = true
		label.Font = Enum.Font.GothamBold
		label.Text = plr.Name
		label.Parent = billboard
	end
end

local function onCharacterAdded(plr, char)
	if espEnabled then
		task.wait(0.5)
		createESP(plr)
	end
end

local function toggleESP()
	espEnabled = not espEnabled
	if espEnabled then
		for _, plr in pairs(Players:GetPlayers()) do
			if plr ~= player then
				createESP(plr)
				plr.CharacterAdded:Connect(function(char)
					onCharacterAdded(plr, char)
				end)
			end
		end
	else
		for _, plr in pairs(Players:GetPlayers()) do
			removeESPFromCharacter(plr.Character)
		end
	end
end

espButton.MouseButton1Click:Connect(toggleESP)

-- Sistema Superman (Super Speed + Super Jump)
local supermanEnabled = false
local originalWalkSpeed = nil
local originalJumpPower = nil

local function toggleSuperman()
	supermanEnabled = not supermanEnabled

	local char = player.Character
	if not char then return end

	local humanoid = char:FindFirstChildOfClass("Humanoid")
	if not humanoid then return end

	if supermanEnabled then
		-- Salva valores originais
		originalWalkSpeed = humanoid.WalkSpeed
		originalJumpPower = humanoid.JumpPower

		-- Ativa super powers
		humanoid.WalkSpeed = 100 -- Super Speed
		humanoid.JumpPower = 150 -- Super Jump

		supermanButton.Text = "SUPERMAN ON"
		supermanButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0) -- Verde quando ativo
	else
		-- Restaura valores originais
		if originalWalkSpeed then
			humanoid.WalkSpeed = originalWalkSpeed
		end
		if originalJumpPower then
			humanoid.JumpPower = originalJumpPower
		end

		supermanButton.Text = "SUPERMAN"
		supermanButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40) -- Cor original
	end
end

-- Restaura superman quando o personagem renascer
player.CharacterAdded:Connect(function(char)
	if supermanEnabled then
		-- Pequeno delay para garantir que o humanoid carregou
		task.wait(1)
		local humanoid = char:FindFirstChildOfClass("Humanoid")
		if humanoid then
			humanoid.WalkSpeed = 100
			humanoid.JumpPower = 150
		end
	end
end)

supermanButton.MouseButton1Click:Connect(toggleSuperman)

-- Sistema de toggle do menu
local menuVisible = false

toggleButton.MouseButton1Click:Connect(function()
	menuVisible = not menuVisible
	frame.Visible = menuVisible

	if menuVisible then
		toggleButton.Text = "FECHAR MENU"
	else
		toggleButton.Text = "ABRIR MENU"
	end
end)
